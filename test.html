<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©ation d'√âv√©nement - Test API</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.8;
            font-size: 1.1em;
        }

        .form-container {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .tarif-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 2px dashed #e1e8ed;
        }

        .tarif-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .tarif-header h4 {
            color: #2c3e50;
        }

        .remove-tarif {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .file-preview {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e1e8ed;
        }

        .file-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 5px;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .response {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .response.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .response.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≠ Cr√©ation d'√âv√©nement</h1>
            <p>Testez votre API de gestion d'√©v√©nements</p>
        </div>

        <div class="form-container">
            <form id="eventForm">
                <!-- Informations de base -->
                <div class="form-section">
                    <h3>üìã Informations de l'√âv√©nement</h3>
                    <div class="form-group">
                        <label for="titre">Titre *</label>
                        <input type="text" id="titre" name="titre" required placeholder="Nom de l'√©v√©nement">
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" placeholder="Description d√©taill√©e de l'√©v√©nement"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="date_debut">Date de d√©but *</label>
                        <input type="datetime-local" id="date_debut" name="date_debut" required>
                    </div>
                    <div class="form-group">
                        <label for="date_fin">Date de fin *</label>
                        <input type="datetime-local" id="date_fin" name="date_fin" required>
                    </div>
                    <div class="form-group">
                        <label for="type_id">Type d'√©v√©nement ID *</label>
                        <input type="text" id="type_id" name="type_id" required placeholder="UUID du type d'√©v√©nement" value="123e4567-e89b-12d3-a456-426614174000">
                    </div>
                </div>

                <!-- Informations du lieu -->
                <div class="form-section">
                    <h3>üìç Lieu de l'√âv√©nement</h3>
                    <div class="form-group">
                        <label for="lieu_nom">Nom du lieu *</label>
                        <input type="text" id="lieu_nom" name="lieu_nom" required placeholder="Nom de la salle/stade">
                    </div>
                    <div class="form-group">
                        <label for="lieu_adresse">Adresse *</label>
                        <input type="text" id="lieu_adresse" name="lieu_adresse" required placeholder="Adresse compl√®te">
                    </div>
                    <div class="form-group">
                        <label for="lieu_ville">Ville *</label>
                        <input type="text" id="lieu_ville" name="lieu_ville" required placeholder="Ville">
                    </div>
                    <div class="form-group">
                        <label for="lieu_capacite">Capacit√©</label>
                        <input type="number" id="lieu_capacite" name="lieu_capacite" placeholder="Nombre de places (optionnel)">
                    </div>
                </div>

                <!-- Tarifs -->
                <div class="form-section">
                    <h3>üí∞ Tarifs et Places</h3>
                    <div id="tarifs-container">
                        <div class="tarif-item">
                            <div class="tarif-header">
                                <h4>Tarif #1</h4>
                            </div>
                            <div class="form-group">
                                <label>Type de place ID *</label>
                                <input type="text" name="type_place_id" required placeholder="UUID du type de place" value="456e4567-e89b-12d3-a456-426614174000">
                            </div>
                            <div class="form-group">
                                <label>Prix *</label>
                                <input type="number" name="prix" required step="0.01" placeholder="Prix">
                            </div>
                            <div class="form-group">
                                <label>Nombre de places *</label>
                                <input type="number" name="nombre_places" required placeholder="Nombre de places">
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addTarif()">+ Ajouter un tarif</button>
                </div>

                <!-- Fichiers -->
                <div class="form-section">
                    <h3>üìé Fichiers associ√©s</h3>
                    <div class="form-group">
                        <label for="fichiers">Ajouter des fichiers</label>
                        <input type="file" id="fichiers" multiple accept="image/*,.pdf,.doc,.docx">
                        <small>Formats accept√©s: images, PDF, Word. Les fichiers seront convertis en base64.</small>
                    </div>
                    <div id="file-previews"></div>
                </div>

                <!-- Bouton de soumission -->
                <button type="submit" class="btn">üöÄ Cr√©er l'√âv√©nement</button>
            </form>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Cr√©ation de l'√©v√©nement en cours...</p>
            </div>

            <!-- R√©ponse -->
            <div class="response" id="response"></div>
        </div>
    </div>

    <script>
        // Gestion des tarifs
        let tarifCount = 1;

        function addTarif() {
            tarifCount++;
            const tarifHTML = `
                <div class="tarif-item">
                    <div class="tarif-header">
                        <h4>Tarif #${tarifCount}</h4>
                        <button type="button" class="remove-tarif" onclick="removeTarif(this)">√ó Supprimer</button>
                    </div>
                    <div class="form-group">
                        <label>Type de place ID *</label>
                        <input type="text" name="type_place_id" required placeholder="UUID du type de place" value="456e4567-e89b-12d3-a456-426614174000">
                    </div>
                    <div class="form-group">
                        <label>Prix *</label>
                        <input type="number" name="prix" required step="0.01" placeholder="Prix">
                    </div>
                    <div class="form-group">
                        <label>Nombre de places *</label>
                        <input type="number" name="nombre_places" required placeholder="Nombre de places">
                    </div>
                </div>
            `;
            document.getElementById('tarifs-container').insertAdjacentHTML('beforeend', tarifHTML);
        }

        function removeTarif(button) {
            if (document.querySelectorAll('.tarif-item').length > 1) {
                button.closest('.tarif-item').remove();
                tarifCount--;
            } else {
                alert('Au moins un tarif est requis');
            }
        }

        // Gestion des fichiers
        document.getElementById('fichiers').addEventListener('change', function(e) {
            const previewsContainer = document.getElementById('file-previews');
            previewsContainer.innerHTML = '';

            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const preview = document.createElement('div');
                    preview.className = 'file-preview';
                    
                    if (file.type.startsWith('image/')) {
                        preview.innerHTML = `
                            <strong>${file.name}</strong> (${(file.size/1024).toFixed(1)} KB)
                            <br>
                            <img src="${e.target.result}" alt="Preview">
                        `;
                    } else {
                        preview.innerHTML = `
                            <strong>${file.name}</strong> (${(file.size/1024).toFixed(1)} KB)
                            <br>
                            <small>${file.type}</small>
                        `;
                    }
                    
                    previewsContainer.appendChild(preview);
                };
                
                reader.readAsDataURL(file);
            });
        });

        // Conversion fichier en base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    // Retirer le pr√©fixe data:image/jpeg;base64,
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        // Soumission du formulaire
        document.getElementById('eventForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const loading = document.getElementById('loading');
            const responseDiv = document.getElementById('response');
            
            // Afficher loading
            submitBtn.disabled = true;
            loading.style.display = 'block';
            responseDiv.style.display = 'none';

            try {
                // R√©cup√©rer les donn√©es du formulaire
                const formData = new FormData(e.target);
                
                // Construire l'objet √©v√©nement
                const eventData = {
                    titre: formData.get('titre'),
                    description: formData.get('description'),
                    date_debut: new Date(formData.get('date_debut')).toISOString(),
                    date_fin: new Date(formData.get('date_fin')).toISOString(),
                    type_id: formData.get('type_id'),
                    lieu_nom: formData.get('lieu_nom'),
                    lieu_adresse: formData.get('lieu_adresse'),
                    lieu_ville: formData.get('lieu_ville'),
                    tarifs: []
                };

                // Capacit√© optionnelle
                const capacite = formData.get('lieu_capacite');
                if (capacite) {
                    eventData.lieu_capacite = parseInt(capacite);
                }

                // R√©cup√©rer les tarifs
                const tarifItems = document.querySelectorAll('.tarif-item');
                tarifItems.forEach(item => {
                    const inputs = item.querySelectorAll('input');
                    eventData.tarifs.push({
                        type_place_id: inputs[0].value,
                        prix: parseFloat(inputs[1].value),
                        nombre_places: parseInt(inputs[2].value)
                    });
                });

                // Traiter les fichiers
                const fileInput = document.getElementById('fichiers');
                if (fileInput.files.length > 0) {
                    eventData.fichiers = [];
                    
                    for (let file of fileInput.files) {
                        const base64Data = await fileToBase64(file);
                        
                        // D√©terminer le type de fichier
                        let typeFichier = 'document';
                        if (file.type.startsWith('image/')) {
                            typeFichier = file.type.includes('poster') || file.name.includes('affiche') ? 'affiche' : 'photo';
                        }
                        
                        eventData.fichiers.push({
                            nom_fichier: file.name,
                            type_mime: file.type,
                            type_fichier: typeFichier,
                            donnees_bytea: base64Data
                        });
                    }
                }

                console.log('Donn√©es envoy√©es:', eventData);

                // Envoyer la requ√™te
                const response = await fetch('http://localhost:3000/v1/evenements', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(eventData)
                });

                const result = await response.json();

                // Afficher la r√©ponse
                responseDiv.className = response.ok ? 'response success' : 'response error';
                responseDiv.innerHTML = response.ok 
                    ? `<h3>‚úÖ Succ√®s!</h3><p><strong>ID:</strong> ${result.id}</p><p><strong>Message:</strong> ${result.message}</p>`
                    : `<h3>‚ùå Erreur</h3><p><strong>Erreur:</strong> ${result.error}</p>`;
                responseDiv.style.display = 'block';

            } catch (error) {
                console.error('Erreur:', error);
                responseDiv.className = 'response error';
                responseDiv.innerHTML = `<h3>‚ùå Erreur</h3><p>Erreur de connexion: ${error.message}</p>`;
                responseDiv.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        });

        // Pr√©-remplir quelques champs pour le test
        document.getElementById('titre').value = 'Concert de Test';
        document.getElementById('description').value = 'Un concert exceptionnel pour tester l\'API';
        
        // Dates par d√©faut (demain)
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('date_debut').value = tomorrow.toISOString().slice(0, 16);
        
        const tomorrowEnd = new Date(tomorrow);
        tomorrowEnd.setHours(tomorrow.getHours() + 3);
        document.getElementById('date_fin').value = tomorrowEnd.toISOString().slice(0, 16);
        
        document.getElementById('lieu_nom').value = 'Salle de Concert Test';
        document.getElementById('lieu_adresse').value = '123 Avenue du Test';
        document.getElementById('lieu_ville').value = 'Paris';
        document.getElementById('lieu_capacite').value = '1000';
        
        // Pr√©-remplir le premier tarif
        const firstTarif = document.querySelector('.tarif-item');
        firstTarif.querySelector('input[name="prix"]').value = '50';
        firstTarif.querySelector('input[name="nombre_places"]').value = '100';
    </script>
</body>
</html>



curl -X POST http://localhost:3000/v1/evenements \
  -H "Content-Type: application/json" \
  -d '{
    "titre": "Concert Coldplay 2024",
    "description": "Concert exceptionnel de Coldplay avec setlist sp√©cial",
    "date_debut": "2027-07-15T20:00:00Z",
    "date_fin": "2027-07-15T23:30:00Z",
    "type_id": "a30b8d7c-8b25-4a91-9e59-0d6f443f4d1b",
    "lieu_nom": "Stade Barea Mahamasina",
    "lieu_adresse": "Mahamasina, Antananarivo",
    "lieu_ville": "Antananarivo",
    "lieu_capacite": 5000,
    "tarifs": [
      {
        "type_place_id": "a1f361de-ca05-42bd-9509-d2c20f77a05f",
        "prix": 25000,
        "nombre_places": 100
      },
      {
        "type_place_id": "6ebe3b37-01bc-462a-a37e-cc3fb3cb5e11",
        "prix": 7000,
        "nombre_places": 2000
      }
    ],
    "fichiers": [
      {
        "nom_fichier": "affiche.jpg",
        "type_mime": "image/jpeg",
        "type_fichier": "affiche",
        "donnees_bytea": "SGVsbG8gV29ybGQ="
      }
    ]
  }'